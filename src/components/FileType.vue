<template>
    <div>
        <div class="title">
            <h1>File</h1>
            <span v-on:click="add" class="btn btn-primary"> + </span>
        </div>

        <div v-for="file in bus.project.FileTypeManager.list" :key="file.name">
            <table v-if="bus.item && file.name == bus.item.name" class="table">
                <caption>
                    <div class="btn-group">
                        <span @click="change('name', file)" class="btn btn-default">{{ file.name }}</span>
                        <span v-if="!file.original" @click="remove(file)" class="btn btn-danger"> X </span>
                    </div>
                </caption>
                <thead>
                    <tr>
                        <th width="160px">Name</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>path</td>
                        <td>
                            <span @click="change('path', file)" class="btn btn-default">{{ plus(file.path) }}</span>
                        </td>
                    </tr>
                    <tr>
                        <td>NameSpace</td>
                        <td>
                            <span @click="change('NameSpace', file)" class="btn btn-default">
                                {{ plus(file.NameSpace) }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>prefix</td>
                        <td>
                            <span @click="change('prefix', file)" class="btn btn-default">{{ plus(file.prefix) }}</span>
                        </td>
                    </tr>
                    <tr>
                        <td>suffix</td>
                        <td>
                            <span @click="change('suffix', file)" class="btn btn-default">{{ plus(file.suffix) }}</span>
                        </td>
                    </tr>
                    <tr>
                        <td>template</td>
                        <td>
                            <span class="btn btn-default">{{ file.template }}</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</template>

<script>
import bus from '../helper/event'
import { see, sure, enter } from '../helper/dialogue'

export default {
    name: 'FileType',
    data() {
        return {
            bus,
        }
    },
    methods: {
        add() {
            enter('Please enter the name').then(result => {
                if (result.value) {
                    try {
                        const file = bus.project.FileTypeManager.make(result.value)
                        bus.project.FileTypeManager.add(file)
                    } catch (error) {
                        see(error, 400)
                    }
                }
            })
        },
        plus(key) {
            if (key) {
                return key
            }
            return '+'
        },
        change(key, owner) {
            enter('Please enter the ' + key, owner[key]).then(result => {
                if (result.value === undefined) {
                    return
                }
                try {
                    owner[key] = result.value
                } catch (error) {
                    see(error, 400)
                }
            })
        },
        remove(file) {
            sure('Are you sure?').then(result => {
                if (result.value) {
                    bus.project.FileTypeManager.remove(file)
                }
            })
        },
    },
}
</script>
